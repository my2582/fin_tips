<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>ê¸ˆìœµ ê¿€Tipë‹¨ì§€</title>

  <!-- Google Analytics 4 -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-FBJWQ0KHB8"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'G-FBJWQ0KHB8', {
      cookie_domain: 'fintips.netlify.app',
      send_page_view: true
    });
  </script>

  <meta name="description" content="ì„¸ë¯¸ë‚˜ Q&Aì™€ ë°”ë¡œ ì‹¤í–‰ Tipì„ í•œ ê³³ì— ëª¨ì€ ê¸ˆìœµ ê¿€Tipë‹¨ì§€">
  <meta property="og:title" content="ê¸ˆìœµ ê¿€Tipë‹¨ì§€">
  <meta property="og:description" content="ì„¸ë¯¸ë‚˜ Q&Aì™€ ë°”ë¡œ ì‹¤í–‰ Tipì„ í•œ ê³³ì— ëª¨ì€ ê¿€Tipë‹¨ì§€">
  <meta property="og:type" content="website">
  <meta name="author" content="Your Name">
  <style>
    :root {
      --bg: #0f172a;
      --fg: #e5e7eb;
      --muted: #9ca3af;
      --card: #111827;
      --accent: #38bdf8;
      --chip: #1f2937;
      --ok: #10b981;
    }
    * { box-sizing: border-box; }
    html, body { margin: 0; padding: 0; background: var(--bg); color: var(--fg); font-family: -apple-system, BlinkMacSystemFont, "Pretendard", "Segoe UI", Roboto, Helvetica, Arial, sans-serif; }
    .wrap { max-width: 780px; margin: 0 auto; padding: 16px; }
    header { display: grid; gap: 8px; padding: 16px; background: linear-gradient(180deg, #0b1220, #0f172a); border-radius: 16px; border: 1px solid #1f2937; }
    h1 { margin: 0; font-size: 22px; line-height: 1.3; }
    .sub { font-size: 12px; color: var(--muted); }
    .updated { font-size: 12px; color: var(--muted); }
    .promo { white-space: pre-wrap; color: var(--muted); font-size: 14px; }
    .toolbar { display: grid; grid-template-columns: 1fr auto; gap: 8px; align-items: center; padding-top: 4px; }
    .search { width: 100%; padding: 12px 14px; border-radius: 12px; border: 1px solid #374151; background: #0b1220; color: var(--fg); font-size: 15px; }
    .counter { font-size: 12px; color: var(--muted); padding: 0 8px; }
    details.section { background: var(--card); border: 1px solid #1f2937; border-radius: 14px; padding: 0; overflow: hidden; }
    details + details { margin-top: 12px; }
    summary { cursor: pointer; list-style: none; padding: 14px 16px; display: flex; align-items: center; justify-content: space-between; gap: 8px; }
    summary::-webkit-details-marker { display: none; }
    .title { font-weight: 600; }
    .datetime { font-size: 12px; color: var(--muted); }
    .badge { background: var(--chip); padding: 4px 8px; border-radius: 999px; font-size: 12px; color: var(--muted); }
    .items { display: grid; gap: 10px; padding: 12px; }
    .card { background: #0b1220; border: 1px solid #1f2937; border-radius: 12px; padding: 12px; display: grid; gap: 8px; }
    .qline { display: flex; align-items: baseline; gap: 8px; flex-wrap: wrap; }
    .qno { font-weight: 700; font-feature-settings: 'tnum' 1, 'lnum' 1; }
    .qtext { font-size: 15px; line-height: 1.5; }
    .askers { font-size: 12px; color: var(--muted); }
    .answer { font-size: 14px; line-height: 1.55; white-space: pre-wrap; }
    .answer a { color: #38bdf8; text-decoration: underline; word-break: break-all; }
    .tip { font-size: 13px; padding: 8px 10px; border-radius: 10px; background: #052e2b; border: 1px solid #064e3b; white-space: pre-wrap; }
    .tip::before { content: "ë°”ë¡œ ì‹¤í–‰ Tip"; display: inline-block; margin-right: 8px; font-weight: 600; color: var(--ok); }
    .badge-new {
      background: #083344;
      border: 1px solid #0e7490;
      color: #67e8f9;
      padding: 2px 6px;
      border-radius: 999px;
      font-size: 11px;
      font-weight: 700;
      letter-spacing: .2px;
      margin-left: 6px;
    }
    .footer { text-align: center; color: var(--muted); font-size: 12px; padding: 20px 0 10px; }
    .owner { margin-top: 6px; font-size: 12px; color: var(--muted); }
    .owner a { color: var(--accent); text-decoration: none; }
    .disclaimer { margin-top: 14px; font-size: 11px; line-height: 1.6; color: var(--muted); border-top: 1px solid #1f2937; padding-top: 12px; text-align: left; }
    
    /* CTA Section Styles */
    .cta-section { margin: 24px 0; padding: 20px; background: linear-gradient(135deg, #1e293b, #0f172a); border: 1px solid #334155; border-radius: 16px; }
    .cta-title { font-size: 20px; font-weight: 700; margin-bottom: 8px; color: var(--fg); }
    .cta-subtitle { font-size: 14px; color: var(--muted); margin-bottom: 20px; }
    .cta-primary { width: 100%; padding: 16px 24px; background: linear-gradient(135deg, #0ea5e9, #0284c7); color: white; border: none; border-radius: 12px; font-size: 16px; font-weight: 600; cursor: pointer; transition: all 0.3s ease; margin-bottom: 16px; }
    .cta-primary:hover { transform: translateY(-2px); box-shadow: 0 10px 25px rgba(14, 165, 233, 0.4); }
    .cta-secondary { display: inline-flex; align-items: center; gap: 8px; padding: 12px 20px; background: #1e293b; color: var(--accent); border: 1px solid #334155; border-radius: 10px; text-decoration: none; font-size: 14px; font-weight: 500; transition: all 0.3s ease; margin: 4px; }
    .cta-secondary:hover { background: #334155; transform: translateY(-1px); }
    .cta-tertiary { display: inline-flex; align-items: center; gap: 6px; padding: 8px 16px; background: transparent; color: var(--muted); border: 1px solid #374151; border-radius: 8px; text-decoration: none; font-size: 13px; transition: all 0.3s ease; margin: 4px; }
    .cta-tertiary:hover { color: var(--accent); border-color: var(--accent); }
    
    /* Guide Modal Styles */
    .guide-modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.8); z-index: 1000; overflow-y: auto; }
    .guide-modal.show { display: flex; align-items: flex-start; justify-content: center; padding: 20px; }
    .guide-content { background: var(--bg); border: 1px solid #334155; border-radius: 16px; max-width: 800px; width: 100%; max-height: 90vh; overflow-y: auto; position: relative; margin-top: 20px; }
    .guide-header { padding: 20px; border-bottom: 1px solid #334155; display: flex; justify-content: space-between; align-items: center; }
    .guide-title { font-size: 18px; font-weight: 600; color: var(--fg); }
    .guide-close { background: none; border: none; color: var(--muted); font-size: 24px; cursor: pointer; padding: 0; width: 30px; height: 30px; display: flex; align-items: center; justify-content: center; }
    .guide-close:hover { color: var(--fg); }
    .guide-nav { padding: 0 20px; border-bottom: 1px solid #334155; }
    .guide-nav-list { display: flex; flex-wrap: wrap; gap: 4px; margin: 0; padding: 0; list-style: none; }
    .guide-nav-item { margin: 0; }
    .guide-nav-link { display: block; padding: 12px 16px; color: var(--muted); text-decoration: none; font-size: 14px; transition: all 0.3s ease; border-bottom: 2px solid transparent; }
    .guide-nav-link.active, .guide-nav-link:hover { color: var(--accent); border-bottom-color: var(--accent); }
    .guide-body { padding: 20px; }
    .guide-item { margin-bottom: 32px; }
    .guide-item:last-child { margin-bottom: 0; }
    .guide-item h3 { color: var(--accent); font-size: 16px; margin-bottom: 16px; }
    .guide-item .guide-description { color: var(--muted); font-size: 14px; line-height: 1.6; margin-bottom: 16px; }
    .guide-item .guide-actions { display: flex; flex-wrap: wrap; gap: 12px; }
    .guide-download-btn { display: inline-flex; align-items: center; gap: 8px; padding: 10px 16px; background: var(--accent); color: var(--bg); border: none; border-radius: 8px; text-decoration: none; font-size: 14px; font-weight: 500; cursor: pointer; transition: all 0.3s ease; }
    .guide-download-btn:hover { background: #0284c7; transform: translateY(-1px); }
    
    @media (min-width: 640px) {
      header { grid-template-columns: 1fr; }
    }
    @media (max-width: 640px) {
      .guide-nav-list { flex-direction: column; }
      .guide-nav-link { border-bottom: none; border-left: 2px solid transparent; }
      .guide-nav-link.active, .guide-nav-link:hover { border-left-color: var(--accent); border-bottom-color: transparent; }
    }
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <h1>ğŸ’¡ ê¸ˆìœµ ê¿€Tipë‹¨ì§€</h1>
      <div class="sub">Maintained by ì—¼ë¯¼ìˆ˜ Â· <a href="mailto:nlfelix@gmail.com">nlfelix@gmail.com</a></div>
      <div class="updated" id="updated"></div>
      <div class="promo" id="promo"></div>
      <div class="toolbar">
        <input id="search" class="search" placeholder="ì§ˆë¬¸Â·ë‹µë³€Â·Tip ê²€ìƒ‰" />
        <div class="counter" id="counter"></div>
      </div>
    </header>
    
    <!-- CTA Section -->
    <section class="cta-section">
      <h2 class="cta-title">ğŸ¯ ì‹±ê°€í¬ë¥´ ê¸ˆìœµ ì™„ì „ì •ë³µ ê°€ì´ë“œ</h2>
      <p class="cta-subtitle">ì‹¤ì „ ê²½í—˜ì„ ë°”íƒ•ìœ¼ë¡œ ë§Œë“  5ê°€ì§€ í•„ìˆ˜ ê°€ì´ë“œë¡œ ê¸ˆìœµ ëª©í‘œë¥¼ ë‹¬ì„±í•˜ì„¸ìš”</p>
      
      <button class="cta-primary" onclick="openGuideModal()">
        ğŸ“š ê¿€Tip ê°€ì´ë“œ ë³´ê¸° (ë¬´ë£Œ)
      </button>
      
      <div style="display: flex; flex-wrap: wrap; gap: 8px; margin-bottom: 12px;">
        <a href="#" class="cta-secondary" onclick="trackCTA('secondary', 'arki_stock_guide'); return false;">
          ğŸ¦ Arki Finance ë°©ë¬¸
        </a>
        <a href="#" class="cta-secondary" onclick="trackCTA('secondary', 'investment_consultation'); return false;">
          ğŸ’¼ íˆ¬ì ì „ë¬¸ê°€ ìƒë‹´
        </a>
      </div>
      
      <div>
        <a href="https://www.linkedin.com/company/arkifinance" class="cta-tertiary" onclick="trackCTA('tertiary', 'linkedin_follow')" target="_blank" rel="noopener">
          ğŸ’¼ LinkedIn íŒ”ë¡œìš°
        </a>
      </div>
    </section>

    <main id="container" style="margin-top:14px; display:grid; gap:12px;"></main>
    <div class="footer">
      <div>ëª¨ë°”ì¼ì—ì„œ ì‰½ê²Œ ë³´ì´ë„ë¡ ìµœì í™”ëœ ë²„ì „ â€¢ ì—…ë°ì´íŠ¸ ê³„ì† ì˜ˆì •</div>
      <div class="owner">Owner: Yeom Minsu Â· <a href="mailto:nlfelix@gmail.com">nlfelix@gmail.com</a></div>
      <div class="disclaimer">
        <strong>ë©´ì±…ì¡°í•­</strong><br>
        ë³¸ ìë£ŒëŠ” ì¼ë°˜ì ì¸ ì •ë³´ ì œê³µì„ ìœ„í•œ ê²ƒì´ë©°, ì–´ë– í•œ ê²½ìš°ì—ë„ íˆ¬ìê¶Œìœ , íˆ¬ììë¬¸ ë˜ëŠ” ë²•ì Â·ì„¸ë¬´ì  ì¡°ì–¸ì— í•´ë‹¹í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤. ì œê³µëœ ì •ë³´ì˜ ì •í™•ì„±Â·ì™„ì „ì„±ì„ ë³´ì¥í•˜ì§€ ì•Šìœ¼ë©°, ë³¸ ìë£Œë¥¼ ì‹ ë¢°í•˜ì—¬ í–‰í•´ì§„ ì–´ë– í•œ í–‰ìœ„ ë˜ëŠ” íˆ¬ì ê²°ê³¼ì— ëŒ€í•´ì„œë„ ì±…ì„ì„ ì§€ì§€ ì•ŠìŠµë‹ˆë‹¤. íˆ¬ì ê²°ì •ê³¼ ê·¸ì— ë”°ë¥¸ ì†ìµì˜ ì±…ì„ì€ ì „ì ìœ¼ë¡œ íˆ¬ìì ë³¸ì¸ì—ê²Œ ìˆìŠµë‹ˆë‹¤. ì‹œì¥ ìƒí™©, ì œë„ ë° ì„¸ë²•ì€ ì˜ˆê³  ì—†ì´ ë³€ê²½ë  ìˆ˜ ìˆìœ¼ë©°, ê³¼ê±°ì˜ ì„±ê³¼ëŠ” ë¯¸ë˜ì˜ ìˆ˜ìµì„ ë³´ì¥í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.
      </div>
    </div>
  </div>

  <!-- Guide Modal -->
  <div class="guide-modal" id="guideModal">
    <div class="guide-content">
      <div class="guide-header">
        <h2 class="guide-title">ğŸ“š ê¸ˆìœµ ê¿€Tip ê°€ì´ë“œ</h2>
        <button class="guide-close" onclick="closeGuideModal()">&times;</button>
      </div>
      <nav class="guide-nav">
        <ul class="guide-nav-list">
          <li class="guide-nav-item">
            <a href="#guide-stock-guide" class="guide-nav-link active" onclick="showGuide('stock-guide', this)">ì£¼ì‹íˆ¬ì ì›ì¹™ ê°€ì´ë“œ</a>
          </li>
          <li class="guide-nav-item">
            <a href="#guide-cpf55-guide" class="guide-nav-link" onclick="showGuide('cpf55-guide', this)">55ì„¸ CPF ë³€í™” ê°€ì´ë“œ</a>
          </li>
          <li class="guide-nav-item">
            <a href="#guide-tax-save-guide" class="guide-nav-link" onclick="showGuide('tax-save-guide', this)">CPFÂ·SRS ì ˆì„¸ ê°€ì´ë“œ</a>
          </li>
        </ul>
      </nav>
      <div class="guide-body" id="guideBody">
        <!-- Guide content will be loaded here -->
      </div>
    </div>
  </div>

  <script>
    // ====== DATA (ë¹Œë“œ ì‹œ ì¹˜í™˜ë©ë‹ˆë‹¤) ======
    const DATA = DATA_PLACEHOLDER;
    // ====== /DATA ======

    // ì•ˆì „í•œ HTML ë³€í™˜ + ë§í¬ + ì¤„ë°”ê¿ˆ ìœ ì§€
    function escapeHtml(str) {
      return String(str).replace(/[&<>"']/g, m => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[m]));
    }
    function linkify(text) {
      const urlRegex = /(https?:\/\/[^\s)<>"']+)/g;
      return text.replace(urlRegex, (url) => `<a href="${url}" target="_blank" rel="noopener noreferrer">${url}</a>`);
    }
    function formatAnswer(raw) {
      const safe = escapeHtml(raw || "");
      const withLinks = linkify(safe);
      return withLinks.replace(/\n/g, "<br>");
    }

    function el(tag, cls, text) {
      const e = document.createElement(tag);
      if (cls) e.className = cls;
      if (text !== undefined) e.textContent = text;
      return e;
    }

    function render(sections, term="") {
      const root = document.getElementById('container');
      root.innerHTML = "";
      let visibleItemCount = 0;

      document.getElementById('promo').textContent = DATA.promo || "";
      document.getElementById('updated').textContent = DATA.lastUpdated ? `ì—…ë°ì´íŠ¸: ${DATA.lastUpdated}` : "";

      sections.forEach(sec => {
        const items = sec.items.filter(it => {
          const hay = (sec.title + " " + sec.datetime + " " + it.q + " " + it.a + " " + (it.tip||"")).toLowerCase();
          return hay.includes(term.toLowerCase());
        });
        if (items.length === 0) return;

        const details = el('details', 'section');
        details.open = true;

        const summary = el('summary');
        const left = el('div');
        left.appendChild(el('div', 'title', sec.title));
        left.appendChild(el('div', 'datetime', sec.datetime));
        summary.appendChild(left);
        summary.appendChild(el('span', 'badge', `ì§ˆë¬¸ ${items.length}ê°œ`));
        details.appendChild(summary);

        const itemsWrap = el('div', 'items');
        items.forEach(it => {
          const card = el('div', 'card');

          const qline = el('div', 'qline');
          qline.appendChild(el('span', 'qno', `Q${it.no}.`));
          qline.appendChild(el('div', 'qtext', it.q));

          // NEW ë±ƒì§€
          if (it.isNew) {
            const badge = el('span', 'badge-new', 'NEW');
            qline.appendChild(badge);
          }

          card.appendChild(qline);

          const askers = el('div', 'askers', `ì§ˆë¬¸ì ìˆ˜: ${it.askers}`);
          card.appendChild(askers);

          const answer = el('div', 'answer');
          answer.innerHTML = formatAnswer(it.a);
          card.appendChild(answer);

          if ((it.tip || "").trim().length > 0) {
            const tip = el('div', 'tip');
            tip.innerHTML = formatAnswer(it.tip);
            card.appendChild(tip);
          }

          itemsWrap.appendChild(card);
          visibleItemCount += 1;
        });

        details.appendChild(itemsWrap);
        root.appendChild(details);
      });

      document.getElementById('counter').textContent = visibleItemCount > 0 ? `ê²°ê³¼ ${visibleItemCount}ê±´` : '';
    }

    const input = document.getElementById('search');
    input.addEventListener('input', (e) => render(DATA.sections, e.target.value));
    render(DATA.sections);
  </script>

  <script>
    (function() {
      const endpoint = '/api/track';
      const storageKey = 'ft_client_id';
      function getCid() {
        try {
          let cid = localStorage.getItem(storageKey);
          if (!cid) {
            cid = 'cid.' + Math.random().toString(36).slice(2) + '.' + Date.now();
            localStorage.setItem(storageKey, cid);
          }
          return cid;
        } catch (_) {
          return 'cid.' + Math.random().toString(36).slice(2) + '.' + Date.now();
        }
      }
      function payload(base) {
        return {
          cid: getCid(),
          page: location.href,
          title: document.title,
          referrer: document.referrer || '',
          lang: navigator.language || '',
          tz: Intl.DateTimeFormat().resolvedOptions().timeZone || '',
          screen: (screen && (screen.width + 'x' + screen.height)) || '',
          ...base,
        };
      }
      function send(data) {
        const blob = new Blob([JSON.stringify(data)], { type: 'application/json' });
        if (navigator.sendBeacon && navigator.sendBeacon(endpoint, blob)) return;
        try {
          fetch(endpoint, { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(data), keepalive: true });
        } catch (_) {}
      }
      // page_view
      send(payload({ event_name: 'page_view' }));

      // search event (throttled)
      const input = document.getElementById('search');
      if (input) {
        let t = 0;
        input.addEventListener('input', (e) => {
          const now = Date.now();
          if (now - t < 1000) return; // throttle 1s
          t = now;
          const q = String(e.target.value || '').slice(0, 200);
          if (!q) return; // only send non-empty
          
          // Keep existing tracking
          send(payload({
            event_name: 'search',
            params: { search_term: q }
          }));
          
          // Add GA4 tracking
          if (typeof gtag === 'function') {
            gtag('event', 'search', {
              search_term: q,
              engagement_time_msec: 1000
            });
          }
        });
      }
    })();
  </script>

  <script>
    // Guide data
    const GUIDES = {
      'stock-guide': {
        title: 'íƒ€ì´ë°ë³´ë‹¤ ì›ì¹™: ê°œì¸íˆ¬ìì ì£¼ì‹ ê°€ì´ë“œ',
        description: 'Schwab ì—°êµ¬ ê¸°ë°˜ Buy&Hold vs ë§¤ë„íƒ€ì´ë° ì „ëµ. ê°œì¸íˆ¬ììë¥¼ ìœ„í•œ ì‹¤ì „ ì£¼ì‹íˆ¬ì ì›ì¹™ê³¼ 3ê°€ì§€ í•µì‹¬ ë£°ì„ ì œê³µí•©ë‹ˆë‹¤.',
        filename: 'ê¸ˆìœµ_ê¿€Tipë‹¨ì§€_ê°€ì´ë“œ01_ì£¼ì‹íˆ¬ìì›ì¹™.html',
        slug: 'stock_guide',
        arki_link: 'https://arkifinance.com?utm_source=guide&utm_medium=website&utm_campaign=stock_guide&expert_referral=yeom_minsu'
      },
      'cpf55-guide': {
        title: '55ì„¸ CPF ë³€í™” ì‹¤ì „ê°€ì´ë“œ',
        description: '55ì„¸ CPF ì œë„ ë³€í™”ì™€ FRS ë‹¬ì„± ì „ëµ. CPF Board ì¶œì²˜ ê¸°ë°˜ ì •í™•í•œ ì •ë³´ì™€ Case A/B ì‹œë‚˜ë¦¬ì˜¤ë¥¼ ìƒì„¸íˆ ì•ˆë‚´í•©ë‹ˆë‹¤.',
        filename: 'ê¸ˆìœµ_ê¿€Tipë‹¨ì§€_ê°€ì´ë“œ02_CPF55ì„¸ë³€í™”.html',
        slug: 'cpf55_guide',
        arki_link: 'https://arkifinance.com?utm_source=guide&utm_medium=website&utm_campaign=cpf55_guide&expert_referral=yeom_minsu'
      },
      'tax-save-guide': {
        title: 'CPFÂ·SRS ì ˆì„¸ ê°€ì´ë“œ',
        description: 'ì†Œë“êµ¬ê°„ë³„ ì ˆì„¸ íš¨ê³¼($1,000ë‹¹ $70~$220)ì™€ CPFÂ·SRS ì‹¤ì „ í™œìš©ë²•. ì„¸ê¸ˆ í˜œíƒì„ ìµœëŒ€í•œ í™œìš©í•˜ëŠ” ì „ëµì„ ì œê³µí•©ë‹ˆë‹¤.',
        filename: 'ê¸ˆìœµ_ê¿€Tipë‹¨ì§€_ê°€ì´ë“œ03_ì ˆì„¸ì „ëµ.html',
        slug: 'tax_save_guide',
        arki_link: 'https://arkifinance.com?utm_source=guide&utm_medium=website&utm_campaign=tax_save_guide&expert_referral=yeom_minsu'
      }
    };

    // Current active guide
    let currentGuide = 'stock-guide';

    // Modal functions
    function openGuideModal() {
      document.getElementById('guideModal').classList.add('show');
      showGuide(currentGuide);
      trackCTA('primary', 'guide_modal_open');
    }

    function closeGuideModal() {
      document.getElementById('guideModal').classList.remove('show');
    }

    function showGuide(guideId, linkElement) {
      currentGuide = guideId;
      const guide = GUIDES[guideId];
      
      // Update active nav link
      document.querySelectorAll('.guide-nav-link').forEach(link => {
        link.classList.remove('active');
      });
      if (linkElement) {
        linkElement.classList.add('active');
      }

      // Update guide content
      const guideBody = document.getElementById('guideBody');
      guideBody.innerHTML = `
        <div class="guide-item">
          <h3>${guide.title}</h3>
          <p class="guide-description">${guide.description}</p>
          <div class="guide-actions">
            <button class="guide-download-btn" onclick="downloadGuide('${guideId}')">
              ğŸ“– ê°€ì´ë“œ ë³´ê¸°
            </button>
            <a href="${guide.arki_link}" class="cta-secondary" onclick="trackCTA('secondary', '${guide.slug}')" target="_blank" rel="noopener">
              ğŸ¦ Arki Finance ë°©ë¬¸
            </a>
          </div>
        </div>
      `;
    }

    // View guide function - opens in new tab
    function downloadGuide(guideId) {
      const guide = GUIDES[guideId];
      
      // Track view event
      trackEbookDownload(guide.slug, guide.filename);
      
      // Open guide in new tab
      const guideUrls = {
        'stock-guide': '/guides/stock-investment-guide.html',
        'cpf55-guide': '/guides/guide2-cover.html', 
        'tax-save-guide': '/guides/guide3-cover.html'
      };
      
      const url = guideUrls[guideId];
      if (url) {
        window.open(url, '_blank', 'noopener,noreferrer');
      } else {
        alert(`"${guide.title}" ê°€ì´ë“œê°€ ê³§ ì¤€ë¹„ë©ë‹ˆë‹¤!\n\ní˜„ì¬ í˜ì´ì§€ë³„ HTMLë¡œ ë³€í™˜ ì¤‘ì…ë‹ˆë‹¤.`);
      }
    }

    // CTA tracking function
    function trackCTA(ctaType, campaign) {
      // GA4 tracking
      if (typeof gtag === 'function') {
        gtag('event', 'cta_click', {
          cta_type: ctaType,
          campaign: campaign,
          engagement_time_msec: 1000
        });
      }

      // Custom tracking (existing endpoint)
      const payload = {
        cid: getCidForTracking(),
        page: location.href,
        title: document.title,
        event_name: 'cta_click',
        params: {
          cta_type: ctaType,
          campaign: campaign
        }
      };
      sendTrackingData(payload);

      // Handle actual link navigation for secondary CTAs
      if (ctaType === 'secondary' && GUIDES[currentGuide]) {
        const guide = GUIDES[currentGuide];
        if (campaign.startsWith('arki_')) {
          setTimeout(() => {
            window.open(guide.arki_link, '_blank', 'noopener,noreferrer');
          }, 100);
        }
      }
    }

    // Ebook download tracking
    function trackEbookDownload(slug, filename) {
      // GA4 tracking
      if (typeof gtag === 'function') {
        gtag('event', 'ebook_download', {
          guide_slug: slug,
          file_name: filename,
          engagement_time_msec: 1000
        });
      }

      // Custom tracking
      const payload = {
        cid: getCidForTracking(),
        page: location.href,
        title: document.title,
        event_name: 'ebook_download',
        params: {
          guide_slug: slug,
          file_name: filename
        }
      };
      sendTrackingData(payload);
    }

    // Form submit tracking (for future use)
    function trackFormSubmit(formType, formData) {
      // GA4 tracking
      if (typeof gtag === 'function') {
        gtag('event', 'form_submit', {
          form_type: formType,
          engagement_time_msec: 1000
        });
      }

      // Custom tracking
      const payload = {
        cid: getCidForTracking(),
        page: location.href,
        title: document.title,
        event_name: 'form_submit',
        params: {
          form_type: formType,
          ...formData
        }
      };
      sendTrackingData(payload);
    }

    // Helper functions for tracking
    function getCidForTracking() {
      try {
        let cid = localStorage.getItem('ft_client_id');
        if (!cid) {
          cid = 'cid.' + Math.random().toString(36).slice(2) + '.' + Date.now();
          localStorage.setItem('ft_client_id', cid);
        }
        return cid;
      } catch (_) {
        return 'cid.' + Math.random().toString(36).slice(2) + '.' + Date.now();
      }
    }

    function sendTrackingData(data) {
      const endpoint = '/api/track';
      const blob = new Blob([JSON.stringify(data)], { type: 'application/json' });
      if (navigator.sendBeacon && navigator.sendBeacon(endpoint, blob)) return;
      try {
        fetch(endpoint, { 
          method: 'POST', 
          headers: { 'Content-Type': 'application/json' }, 
          body: JSON.stringify(data), 
          keepalive: true 
        });
      } catch (_) {}
    }

    // Close modal on outside click
    document.getElementById('guideModal').addEventListener('click', function(e) {
      if (e.target === this) {
        closeGuideModal();
      }
    });

    // Close modal on Escape key
    document.addEventListener('keydown', function(e) {
      if (e.key === 'Escape') {
        closeGuideModal();
      }
    });

    // Initialize default guide content
    document.addEventListener('DOMContentLoaded', function() {
      showGuide('stock-guide');
    });
  </script>
</body>
</html>