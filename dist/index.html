<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>금융 꿀Tip단지</title>

  <!-- Google Analytics 4 -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-FBJWQ0KHB8"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'G-FBJWQ0KHB8', {
      cookie_domain: 'fintips.netlify.app',
      send_page_view: true
    });
  </script>

  <meta name="description" content="세미나 Q&A와 바로 실행 Tip을 한 곳에 모은 금융 꿀Tip단지">
  <meta property="og:title" content="금융 꿀Tip단지">
  <meta property="og:description" content="세미나 Q&A와 바로 실행 Tip을 한 곳에 모은 꿀Tip단지">
  <meta property="og:type" content="website">
  <meta name="author" content="Your Name">
  <style>
    :root {
      --bg: #0f172a;
      --fg: #e5e7eb;
      --muted: #9ca3af;
      --card: #111827;
      --accent: #38bdf8;
      --chip: #1f2937;
      --ok: #10b981;
    }
    * { box-sizing: border-box; }
    html, body { margin: 0; padding: 0; background: var(--bg); color: var(--fg); font-family: -apple-system, BlinkMacSystemFont, "Pretendard", "Segoe UI", Roboto, Helvetica, Arial, sans-serif; }
    .wrap { max-width: 780px; margin: 0 auto; padding: 16px; }
    header { display: grid; gap: 8px; padding: 16px; background: linear-gradient(180deg, #0b1220, #0f172a); border-radius: 16px; border: 1px solid #1f2937; }
    h1 { margin: 0; font-size: 22px; line-height: 1.3; }
    .sub { font-size: 12px; color: var(--muted); }
    .updated { font-size: 12px; color: var(--muted); }
    .promo { white-space: pre-wrap; color: var(--muted); font-size: 14px; }
    .toolbar { display: grid; grid-template-columns: 1fr auto; gap: 8px; align-items: center; padding-top: 4px; }
    .search { width: 100%; padding: 12px 14px; border-radius: 12px; border: 1px solid #374151; background: #0b1220; color: var(--fg); font-size: 15px; }
    .counter { font-size: 12px; color: var(--muted); padding: 0 8px; }
    details.section { background: var(--card); border: 1px solid #1f2937; border-radius: 14px; padding: 0; overflow: hidden; }
    details + details { margin-top: 12px; }
    summary { cursor: pointer; list-style: none; padding: 14px 16px; display: flex; align-items: center; justify-content: space-between; gap: 8px; }
    summary::-webkit-details-marker { display: none; }
    .title { font-weight: 600; }
    .datetime { font-size: 12px; color: var(--muted); }
    .badge { background: var(--chip); padding: 4px 8px; border-radius: 999px; font-size: 12px; color: var(--muted); }
    .items { display: grid; gap: 10px; padding: 12px; }
    .card { background: #0b1220; border: 1px solid #1f2937; border-radius: 12px; padding: 12px; display: grid; gap: 8px; }
    .qline { display: flex; align-items: baseline; gap: 8px; flex-wrap: wrap; }
    .qno { font-weight: 700; font-feature-settings: 'tnum' 1, 'lnum' 1; }
    .qtext { font-size: 15px; line-height: 1.5; }
    .askers { font-size: 12px; color: var(--muted); }
    .answer { font-size: 14px; line-height: 1.55; white-space: pre-wrap; }
    .answer a { color: #38bdf8; text-decoration: underline; word-break: break-all; }
    .tip { font-size: 13px; padding: 8px 10px; border-radius: 10px; background: #052e2b; border: 1px solid #064e3b; white-space: pre-wrap; }
    .tip::before { content: "바로 실행 Tip"; display: inline-block; margin-right: 8px; font-weight: 600; color: var(--ok); }
    .badge-new {
      background: #083344;
      border: 1px solid #0e7490;
      color: #67e8f9;
      padding: 2px 6px;
      border-radius: 999px;
      font-size: 11px;
      font-weight: 700;
      letter-spacing: .2px;
      margin-left: 6px;
    }
    .footer { text-align: center; color: var(--muted); font-size: 12px; padding: 20px 0 10px; }
    .owner { margin-top: 6px; font-size: 12px; color: var(--muted); }
    .owner a { color: var(--accent); text-decoration: none; }
    .disclaimer { margin-top: 14px; font-size: 11px; line-height: 1.6; color: var(--muted); border-top: 1px solid #1f2937; padding-top: 12px; text-align: left; }
    
    /* CTA Section Styles */
    .cta-section { margin: 24px 0; padding: 20px; background: linear-gradient(135deg, #1e293b, #0f172a); border: 1px solid #334155; border-radius: 16px; }
    .cta-title { font-size: 20px; font-weight: 700; margin-bottom: 8px; color: var(--fg); }
    .cta-subtitle { font-size: 14px; color: var(--muted); margin-bottom: 20px; }
    .cta-primary { width: 100%; padding: 16px 24px; background: linear-gradient(135deg, #0ea5e9, #0284c7); color: white; border: none; border-radius: 12px; font-size: 16px; font-weight: 600; cursor: pointer; transition: all 0.3s ease; margin-bottom: 16px; }
    .cta-primary:hover { transform: translateY(-2px); box-shadow: 0 10px 25px rgba(14, 165, 233, 0.4); }
    .cta-secondary { display: inline-flex; align-items: center; gap: 8px; padding: 12px 20px; background: #1e293b; color: var(--accent); border: 1px solid #334155; border-radius: 10px; text-decoration: none; font-size: 14px; font-weight: 500; transition: all 0.3s ease; margin: 4px; }
    .cta-secondary:hover { background: #334155; transform: translateY(-1px); }
    .cta-tertiary { display: inline-flex; align-items: center; gap: 6px; padding: 8px 16px; background: transparent; color: var(--muted); border: 1px solid #374151; border-radius: 8px; text-decoration: none; font-size: 13px; transition: all 0.3s ease; margin: 4px; }
    .cta-tertiary:hover { color: var(--accent); border-color: var(--accent); }
    
    /* Guide Modal Styles */
    .guide-modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.8); z-index: 1000; overflow-y: auto; }
    .guide-modal.show { display: flex; align-items: flex-start; justify-content: center; padding: 20px; }
    .guide-content { background: var(--bg); border: 1px solid #334155; border-radius: 16px; max-width: 800px; width: 100%; max-height: 90vh; overflow-y: auto; position: relative; margin-top: 20px; }
    .guide-header { padding: 20px; border-bottom: 1px solid #334155; display: flex; justify-content: space-between; align-items: center; }
    .guide-title { font-size: 18px; font-weight: 600; color: var(--fg); }
    .guide-close { background: none; border: none; color: var(--muted); font-size: 24px; cursor: pointer; padding: 0; width: 30px; height: 30px; display: flex; align-items: center; justify-content: center; }
    .guide-close:hover { color: var(--fg); }
    .guide-nav { padding: 0 20px; border-bottom: 1px solid #334155; }
    .guide-nav-list { display: flex; flex-wrap: wrap; gap: 4px; margin: 0; padding: 0; list-style: none; }
    .guide-nav-item { margin: 0; }
    .guide-nav-link { display: block; padding: 12px 16px; color: var(--muted); text-decoration: none; font-size: 14px; transition: all 0.3s ease; border-bottom: 2px solid transparent; }
    .guide-nav-link.active, .guide-nav-link:hover { color: var(--accent); border-bottom-color: var(--accent); }
    .guide-body { padding: 20px; }
    .guide-item { margin-bottom: 32px; }
    .guide-item:last-child { margin-bottom: 0; }
    .guide-item h3 { color: var(--accent); font-size: 16px; margin-bottom: 16px; }
    .guide-item .guide-description { color: var(--muted); font-size: 14px; line-height: 1.6; margin-bottom: 16px; }
    .guide-item .guide-actions { display: flex; flex-wrap: wrap; gap: 12px; }
    .guide-download-btn { display: inline-flex; align-items: center; gap: 8px; padding: 10px 16px; background: var(--accent); color: var(--bg); border: none; border-radius: 8px; text-decoration: none; font-size: 14px; font-weight: 500; cursor: pointer; transition: all 0.3s ease; }
    .guide-download-btn:hover { background: #0284c7; transform: translateY(-1px); }
    
    @media (min-width: 640px) {
      header { grid-template-columns: 1fr; }
    }
    @media (max-width: 640px) {
      .guide-nav-list { flex-direction: column; }
      .guide-nav-link { border-bottom: none; border-left: 2px solid transparent; }
      .guide-nav-link.active, .guide-nav-link:hover { border-left-color: var(--accent); border-bottom-color: transparent; }
    }
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <h1><a href="/" style="text-decoration: none; color: inherit; cursor: pointer;">💡 금융 꿀Tip단지</a></h1>
      <div class="sub">Maintained by 염민수 · <a href="mailto:nlfelix@gmail.com">nlfelix@gmail.com</a></div>
      <div class="updated" id="updated"></div>
      <div class="promo" id="promo"></div>
      <div class="toolbar">
        <input id="search" class="search" placeholder="질문·답변·Tip 검색" />
        <div class="counter" id="counter"></div>
      </div>
    </header>
    
    <!-- CTA Section -->
    <section class="cta-section">
      <h2 class="cta-title">🎯 싱가포르 금융 실전 가이드</h2>
      <p class="cta-subtitle">실전 경험을 바탕으로 만든 2가지 핵심 가이드로 금융 목표를 달성하세요</p>
      
      <button class="cta-primary" onclick="openGuideModal()">
        📚 꿀Tip 가이드 보기 (무료)
      </button>
      
      <div style="display: flex; flex-wrap: wrap; gap: 8px; margin-bottom: 12px;">
        <a href="#" class="cta-secondary" onclick="trackCTA('secondary', 'arki_stock_guide'); return false;">
          🏦 Arki Finance 방문
        </a>
        <a href="https://forms.office.com/r/ysKrqYZdJ5" class="cta-secondary" onclick="openSeminarSurvey(); trackCTA('secondary', 'seminar_survey'); return false;" target="_blank" rel="noopener">
          📋 다음 세미나 주제 제안하기
        </a>
      </div>
      
      <div>
        <a href="https://www.linkedin.com/company/arkifinance" class="cta-tertiary" onclick="trackCTA('tertiary', 'linkedin_follow')" target="_blank" rel="noopener">
          💼 LinkedIn 팔로우
        </a>
      </div>
    </section>

    <main id="container" style="margin-top:14px; display:grid; gap:12px;"></main>
    <div class="footer">
      <div>모바일에서 쉽게 보이도록 최적화된 버전 • 업데이트 계속 예정</div>
      <div class="owner">Owner: Yeom Minsu · <a href="mailto:nlfelix@gmail.com">nlfelix@gmail.com</a></div>
      <div class="disclaimer">
        <strong>면책조항</strong><br>
        본 자료는 일반적인 정보 제공을 위한 것이며, 어떠한 경우에도 투자권유, 투자자문 또는 법적·세무적 조언에 해당하지 않습니다. 제공된 정보의 정확성·완전성을 보장하지 않으며, 본 자료를 신뢰하여 행해진 어떠한 행위 또는 투자 결과에 대해서도 책임을 지지 않습니다. 투자 결정과 그에 따른 손익의 책임은 전적으로 투자자 본인에게 있습니다. 시장 상황, 제도 및 세법은 예고 없이 변경될 수 있으며, 과거의 성과는 미래의 수익을 보장하지 않습니다.
      </div>
    </div>
  </div>

  <!-- Guide Modal -->
  <div class="guide-modal" id="guideModal">
    <div class="guide-content">
      <div class="guide-header">
        <h2 class="guide-title">📚 금융 꿀Tip 가이드</h2>
        <button class="guide-close" onclick="closeGuideModal()">&times;</button>
      </div>
      <nav class="guide-nav">
        <ul class="guide-nav-list">
          <li class="guide-nav-item">
            <a href="guides/stock-investment-guide.html" class="guide-nav-link active" onclick="trackGuideClick('stock-guide')">주식투자 원칙 가이드</a>
          </li>
          <li class="guide-nav-item">
            <a href="guides/cpf-retirement-guide.html" class="guide-nav-link" onclick="trackGuideClick('cpf55-guide')">55세 CPF 변화 가이드</a>
          </li>
        </ul>
      </nav>
      <div class="guide-body" id="guideBody">
        <!-- Guide content will be loaded here -->
      </div>
    </div>
  </div>

  <script>
    // ====== DATA (빌드 시 치환됩니다) ======
    const DATA = {"promo":"참가자들의 높은 만족도와 추천으로 검증된 실전 금융 가이드 🎉\n'정보가 너무 많아 뭐가 맞는지 모르겠다'는 고민을 완벽 해결해드립니다.","sections":[{"title":"온라인 2차","datetime":"2025년 8월 28일","items":[{"no":1,"q":"55세에 CPF에서 무슨 일이 일어나나요?","a":"RA(Retirement Account) 자동 생성되며 SA→OA 순으로 FRS($213,000)까지 채웁니다. FRS 충족 시 65세부터 월 $1,700 평생 수령하는 CPF LIFE가 시작됩니다. 참고) https://www.cpf.gov.sg/service/article/how-much-cpf-payouts-can-i-get-every-month","tip":"전략 예시) OA 최소화, SA 극대화, 연 $8,000 탑업으로 절세와 4% 복리 효과를 동시에 누리세요. 단, OA로 주택 매수를 할 경우 다른 전략이 필요합니다.","isNew":true,"askers":5},{"no":2,"q":"귀국 시 CPF 환급은 어떻게 하나요?","a":"PR 포기 시 CPF 자동 폐쇄되며 12주 내 송금됩니다. 인출금액에 과세되지 않습니다. 해외 진행 시 공증/아포스티유 필요하므로 귀국 직전 싱가포르 내에서 처리가 유리합니다. 참고) https://www.cpf.gov.sg/member/account-services/account-closure/closing-your-account-when-you-leave-singapore","tip":"귀국 직전 싱가포르 내에서 CPF 환급 절차를 완료하세요.","isNew":true,"askers":3},{"no":3,"q":"CPF/SRS 절세 효과가 정말 확정 수익인가요?","a":"맞습니다. \"불입액 × 본인의 소득세 한계 세율\"만큼 소득세가 줄어듭니다.  $1,000당 $70~$220 절세 가능합니다. 소득이 높을수록 CPF Top-up과 SRS 추가 불입의 절세율이 더 커집니다. 단, 외국인은 하단 7번 \"비영주권자 SRS 활용법\"도 꼭 읽어 주세요.","tip":"본인 한계세율 확인하고 절세하세요. 소득공제 가능한 한도는 연간 CPF $8,000, SRS는 외국인 $35,700, PR $15,300입니다.","isNew":true,"askers":3},{"no":4,"q":"주식 매도 타이밍을 어떻게 잡아야 하나요?","a":"Schwab 연구에 따르면 20년간 매년 최고점에서만 투자해도 현금 보유자보다 3.2배 더 벌었습니다. 마켓 타이밍이 아니라 시장에 오래 남아있는 것이 성과를 결정합니다. 참고) https://www.schwab.com/learn/story/does-market-timing-work","tip":"매도할 때는 재진입 계획을 반드시 세우고, 본인만의 '잠 못 이루는 기준선'을 정하세요.","isNew":true,"askers":2},{"no":5,"q":"싱가포르 주식시장만으로 포트폴리오 구성 가능한가요?","a":"어렵습니다. 은행주 50% + 리츠 16%로 구성된 배당형 시장이라 성장 포트폴리오 구성이 어렵습니다. 성장을 원한다면 글로벌 주식·ETF 병행이 필요합니다.","tip":"싱가포르 시장과 함께 글로벌 주식 ETF로 분산투자하세요.","isNew":true,"askers":2},{"no":6,"q":"CPF IS 투자상품 vs CPF 기본 이자율 중 뭐가 좋나요?","a":"충격적인 사실입니다. CPF IS 펀드 평균 수익률이 3년 연환산 2.01%로 CPF 기본 이자율(OA 2.5%, SA/MA 4%)보다 낮습니다. 참고) https://imas.org.sg/wp-content/uploads/2025/06/IMAS_Q12025_Performance_RiskMonitoring-report_Final.pdf","tip":"투자상품에 대해 잘 모른다면 CPF IS 투자보다는 안정적인 CPF 기본 이자율(특히 SA/MA 4%)을 선택하세요.","isNew":true,"askers":1},{"no":7,"q":"비영주권자 SRS 활용법은?","a":"미래는 알 수 없으므로 우선 SRS 계좌 개설하고 소액(100불이라도) 넣어 두면 좋습니다. 외국인 특별 혜택으로 SRS 10년 보유 후 전액 일시불로 인출하면, 인출액의 50%에 대해서만 과세됩니다. 외국인은 연간 최대 $35,700 소득공제 가능하나 최소 10년의 유동성 제약 있으므로 과욕 금물입니다. 그 이전에 인출하면 5% 패널티가 있습니다. 한계세율이 높은 고소득자일수록 고려해 볼만 합니다. 참고) https://www.iras.gov.sg/taxes/individual-income-tax/basics-of-individual-income-tax/special-tax-schemes/tax-on-srs-withdrawals","tip":"사회초년생은 유동성 우선, SRS 납입 과욕하지 마세요.","isNew":true,"askers":1},{"no":8,"q":"싱가포르 단/중/장기 투자 플랜은?","a":"자산관리의 가장 중요한 원칙, \"내 돈을 중간에 다른 용도로 쓰지 않기로 한 시간에 대한 적절한 보상을 받아야 마땅함\"에 의거하여, 단기(0-2년): MMF 2-3%, 중기(2-7년): 채권펀드/리츠 4-6%, 장기(7년+): 글로벌 주식 8-10%  또는 투자전략 가입으로 나누어 전략을 세우세요. 목적에 따라 이렇게 3개의 '버킷'으로 시간을 나누어 접근하는 것이 핵심입니다. 참고) https://arkifinance.com","tip":"목표와 상황별로 자산을 버킷으로 나누어 기간별 투자 전략을 세우세요.","isNew":true,"askers":1},{"no":9,"q":"한국 vs 싱가포르 세금 차이는?","a":"싱가포르는 상장주식 양도차익에 대한 과세가 없고, 상속/증여세 면세인 반면 한국은 해외주식 22% 분리과세, 상속/증여세 10~50%입니다. 미국 주식 배당은 싱가포르 30% vs 한국 15% + 금융소득 2천만원 초과 시 종합과세입니다.","tip":"싱가포르의 낮은 세율을 활용하되 세부 사항은 세무 전문가와 반드시 상담하세요.","isNew":true,"askers":1}]},{"title":"온라인 2차 사전질문","datetime":"2025년 8월 10일","items":[{"no":1,"q":"싱가포르에 은이나 구리 ETF가 있나요?","a":"상장돼 있지 않습니다. https://www.sgx.com/securities/etf-screener 가셔서 Asset class를 Commodity로 두면 원자재 관련 ETF가 '금'만 나옵니다.","tip":"","isNew":false,"askers":1},{"no":2,"q":"커버하는 국가가 제일 많은 IBKR에서조차 한국 개별주식 거래가 안 되는 이유는?","a":"현재 국내 증권사의 계열사 또는 대주주만 한국 주식거래용 계좌개설을 할 수 있기 때문입니다. 그렇지만 현재 규제완화 중으로, 앞으로 가능해질 수 있습니다. 참고: https://www.kocis.go.kr/koreanet/view.do?seq=1051073","tip":"","isNew":false,"askers":1}]},{"title":"오프라인 1:1 세션 1차","datetime":"2025년 7월 - 8월","items":[{"no":1,"q":"여유 자금의 지나친 안전자산 중심배분(80%+)에서 벗어나는 법","a":"질문자의 상황상 세미나의 단기(A), 중기(B), 장기(C) 배분에서 A=3개월 월급, C의 Maximum은 전체 금융자산의 70%. 안전자산 중심에서 의미있게 벗어나려면? 전체 주식시장 또는 투자전략을 사길 권장.","tip":"","isNew":false,"askers":1},{"no":2,"q":"한국의 원화자산 투자","a":"TDF 권장. 이유는 원화자산 투자에 신경을 줄이면서 동시에 전체 주식시장/채권시장 투자 가능하기 때문 (TDF란 나이 들어갈수록 주식비중 줄여주는 펀드 상품)","tip":"","isNew":false,"askers":1},{"no":3,"q":"싱가포르 달러로 원화 환전 시 환차익을 보는데, 한국 계좌/싱가포르 계좌간 적당한 투자비율은?","a":"환 시장을 보고 원화 신규 투자처 고민에 시간을 투자하는 것은 권장하지 않음. 환차익을 보고 원화로 투자하는 것은 효율적인 시간 활용이 아니고 장기간 이익보는 거래는 불가능한데다 송금 금액도 크지 않아 차익의 크기도 크지 않을 것이기 때문임.","tip":"","isNew":false,"askers":1}]},{"title":"온라인 1차","datetime":"2025.7.24 밤9 - 10시","items":[{"no":1,"q":"\"나의\" 재테크 전략, 어떻게 하면 좋을까요?","a":"(1) 자산관리의 가장 중요한 원칙: 시간에 대한 적절한 보상을 받아야 마땅하다는 것.\n(2) 자산증식의 핵심은 수익률(in % return)이 아닌 수익금(in amount)\n(3) \"나의(개인화된)\" 자산관리의 시작은 시간과 amount에 대한 고민에서 시작 - 실행은 오히려 쉬움","tip":"초단기채권펀드(MMF)만 사도 싱가포르 은행 이자 0.05%보다 수십 배 더 이자 나옵니다.","isNew":false,"askers":11},{"no":2,"q":"싱가포르 세금 시스템에 대해 알고 싶어요.","a":"(1) 싱가포르 상장주식, 미국 상장주식: 양도차익에 대한 세금이 없어요.\n(2) 싱가포르 주식에서 나오는 배당: 세금 없어요.\n(3) 미국 주식, 미국 상장ETF에서 나오는 배당: 배당액의 30% 떼요. 예) 1천불 투자, 50불 배당 -> 15불 세금\n(4) 영국에 상장된 미국투자ETF (\"UCITS\")에서 나오는 배당: 배당액의 15%만 떼요. 예) 위와 동일 -> 7.5불 세금","tip":"싱가포르의 낮은 세율을 활용하되 세부 사항은 세무 전문가와 반드시 상담하세요.","isNew":false,"askers":2},{"no":3,"q":"싱가포르에서의 한국주식 투자방법","a":"한국증권사의 앱을 사용해야 합니다. 다른 나라 앱으로는 거래 안 돼요.","tip":"","isNew":false,"askers":2},{"no":4,"q":"국민연금 어떻게 하죠?","a":"최소금액 납부를 권장합니다. 왜냐하면 싱가포르 거주자는 한국 입장에서는 저소득층으로 분류되기 때문에 혜택이 크기 때문","tip":"","isNew":false,"askers":2},{"no":5,"q":"한국에서 싱가포르로의 자산이전","a":"별도 문의 시 해당 분야 전문가 소개 가능","tip":"","isNew":false,"askers":1}]}]};
    // ====== /DATA ======

    // 안전한 HTML 변환 + 링크 + 줄바꿈 유지
    function escapeHtml(str) {
      return String(str).replace(/[&<>"']/g, m => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[m]));
    }
    function linkify(text) {
      const urlRegex = /(https?:\/\/[^\s)<>"']+)/g;
      return text.replace(urlRegex, (url) => `<a href="${url}" target="_blank" rel="noopener noreferrer">${url}</a>`);
    }
    function formatAnswer(raw) {
      const safe = escapeHtml(raw || "");
      const withLinks = linkify(safe);
      return withLinks.replace(/\n/g, "<br>");
    }

    function el(tag, cls, text) {
      const e = document.createElement(tag);
      if (cls) e.className = cls;
      if (text !== undefined) e.textContent = text;
      return e;
    }

    function render(sections, term="") {
      const root = document.getElementById('container');
      root.innerHTML = "";
      let visibleItemCount = 0;

      document.getElementById('promo').textContent = DATA.promo || "";
      document.getElementById('updated').textContent = DATA.lastUpdated ? `업데이트: ${DATA.lastUpdated}` : "";

      sections.forEach(sec => {
        const items = sec.items.filter(it => {
          const hay = (sec.title + " " + sec.datetime + " " + it.q + " " + it.a + " " + (it.tip||"")).toLowerCase();
          return hay.includes(term.toLowerCase());
        });
        if (items.length === 0) return;

        const details = el('details', 'section');
        details.open = true;

        const summary = el('summary');
        const left = el('div');
        left.appendChild(el('div', 'title', sec.title));
        left.appendChild(el('div', 'datetime', sec.datetime));
        summary.appendChild(left);
        summary.appendChild(el('span', 'badge', `질문 ${items.length}개`));
        details.appendChild(summary);

        const itemsWrap = el('div', 'items');
        items.forEach(it => {
          const card = el('div', 'card');

          const qline = el('div', 'qline');
          qline.appendChild(el('span', 'qno', `Q${it.no}.`));
          qline.appendChild(el('div', 'qtext', it.q));

          // NEW 뱃지
          if (it.isNew) {
            const badge = el('span', 'badge-new', 'NEW');
            qline.appendChild(badge);
          }

          card.appendChild(qline);

          const askers = el('div', 'askers', `질문자 수: ${it.askers}`);
          card.appendChild(askers);

          const answer = el('div', 'answer');
          answer.innerHTML = formatAnswer(it.a);
          card.appendChild(answer);

          if ((it.tip || "").trim().length > 0) {
            const tip = el('div', 'tip');
            tip.innerHTML = formatAnswer(it.tip);
            card.appendChild(tip);
          }

          itemsWrap.appendChild(card);
          visibleItemCount += 1;
        });

        details.appendChild(itemsWrap);
        root.appendChild(details);
      });

      document.getElementById('counter').textContent = visibleItemCount > 0 ? `결과 ${visibleItemCount}건` : '';
    }

    const input = document.getElementById('search');
    input.addEventListener('input', (e) => render(DATA.sections, e.target.value));
    render(DATA.sections);
  </script>

  <script>
    (function() {
      const endpoint = '/api/track';
      const storageKey = 'ft_client_id';
      function getCid() {
        try {
          let cid = localStorage.getItem(storageKey);
          if (!cid) {
            cid = 'cid.' + Math.random().toString(36).slice(2) + '.' + Date.now();
            localStorage.setItem(storageKey, cid);
          }
          return cid;
        } catch (_) {
          return 'cid.' + Math.random().toString(36).slice(2) + '.' + Date.now();
        }
      }
      function payload(base) {
        return {
          cid: getCid(),
          page: location.href,
          title: document.title,
          referrer: document.referrer || '',
          lang: navigator.language || '',
          tz: Intl.DateTimeFormat().resolvedOptions().timeZone || '',
          screen: (screen && (screen.width + 'x' + screen.height)) || '',
          ...base,
        };
      }
      function send(data) {
        const blob = new Blob([JSON.stringify(data)], { type: 'application/json' });
        if (navigator.sendBeacon && navigator.sendBeacon(endpoint, blob)) return;
        try {
          fetch(endpoint, { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(data), keepalive: true });
        } catch (_) {}
      }
      // page_view
      send(payload({ event_name: 'page_view' }));

      // search event (throttled)
      const input = document.getElementById('search');
      if (input) {
        let t = 0;
        input.addEventListener('input', (e) => {
          const now = Date.now();
          if (now - t < 1000) return; // throttle 1s
          t = now;
          const q = String(e.target.value || '').slice(0, 200);
          if (!q) return; // only send non-empty
          
          // Keep existing tracking
          send(payload({
            event_name: 'search',
            params: { search_term: q }
          }));
          
          // Add GA4 tracking
          if (typeof gtag === 'function') {
            gtag('event', 'search', {
              search_term: q,
              engagement_time_msec: 1000
            });
          }
          
          // Enhanced tracking: Search performed
          if (typeof trackUserScore === 'function') {
            trackUserScore('search_performed', 8, {
              search_term: q.substring(0, 50), // Limit for privacy
              search_length: q.length
            });
          }
        });
      }
    })();
  </script>

  <script>
    // Guide data
    const GUIDES = {
      'stock-guide': {
        title: '타이밍보다 원칙: 개인투자자 주식 가이드',
        description: 'Buy&Hold vs 매도타이밍 전략 비교분석. 개인투자자를 위한 실전 주식투자 원칙과 3가지 핵심 룰을 제공합니다.',
        filename: '금융_꿀Tip단지_가이드01_주식투자원칙.html',
        slug: 'stock_guide',
        arki_link: 'https://arkifinance.com?utm_source=guide&utm_medium=website&utm_campaign=stock_guide&expert_referral=yeom_minsu'
      },
      'cpf55-guide': {
        title: '55세 CPF 변화 실전가이드',
        description: '55세 CPF 제도 변화와 FRS 달성 전략. CPF Board 출처 기반 정확한 정보와 Case A/B 시나리오를 상세히 안내합니다.',
        filename: 'CPF_Retirement_Guide_55세변화실전가이드.html',
        slug: 'cpf_retirement_guide',
        arki_link: 'https://arkifinance.com?utm_source=guide&utm_medium=website&utm_campaign=cpf_retirement_guide&expert_referral=yeom_minsu'
      }
      // Guide 3 will be added later
      // 'tax-save-guide': {
      //   title: 'CPF·SRS 절세 가이드',
      //   description: '소득구간별 절세 효과($1,000당 $70~$220)와 CPF·SRS 실전 활용법. 세금 혜택을 최대한 활용하는 전략을 제공합니다.',
      //   filename: '금융_꿀Tip단지_가이드03_절세전략.html',
      //   slug: 'tax_save_guide',
      //   arki_link: 'https://arkifinance.com?utm_source=guide&utm_medium=website&utm_campaign=tax_save_guide&expert_referral=yeom_minsu'
      // }
    };

    // Current active guide
    let currentGuide = 'stock-guide';

    // Modal functions
    function openGuideModal() {
      document.getElementById('guideModal').classList.add('show');
      showGuide(currentGuide);
      trackCTA('primary', 'guide_modal_open');
      
      // Enhanced tracking: Guide modal opened
      trackUserScore('guide_modal_open', 15, {
        modal_type: 'guide_selection',
        available_guides: Object.keys(GUIDES).length
      });
    }

    function closeGuideModal() {
      document.getElementById('guideModal').classList.remove('show');
    }

    function showGuide(guideId, linkElement) {
      currentGuide = guideId;
      const guide = GUIDES[guideId];
      
      // Update active nav link
      document.querySelectorAll('.guide-nav-link').forEach(link => {
        link.classList.remove('active');
      });
      if (linkElement) {
        linkElement.classList.add('active');
      }

      // Update guide content
      const guideBody = document.getElementById('guideBody');
      guideBody.innerHTML = `
        <div class="guide-item">
          <h3>${guide.title}</h3>
          <p class="guide-description">${guide.description}</p>
          <div class="guide-actions">
            <button class="guide-download-btn" onclick="downloadGuide('${guideId}')">
              📖 가이드 보기
            </button>
            <a href="${guide.arki_link}" class="cta-secondary" onclick="trackCTA('secondary', '${guide.slug}')" target="_blank" rel="noopener">
              🏦 Arki Finance 방문
            </a>
          </div>
        </div>
      `;
    }

    // View guide function - opens in new tab
    function downloadGuide(guideId) {
      const guide = GUIDES[guideId];
      
      // Track view event
      trackEbookDownload(guide.slug, guide.filename);
      
      // Enhanced tracking: Guide downloaded
      trackUserScore('guide_download', 25, {
        guide_id: guideId,
        guide_type: guide.slug,
        guide_title: guide.title
      });
      
      // Open guide in new tab
      const guideUrls = {
        'stock-guide': '/guides/stock-investment-guide.html',
        'cpf55-guide': '/guides/cpf-retirement-guide.html'
      };
      
      const url = guideUrls[guideId];
      if (url) {
        window.open(url, '_blank', 'noopener,noreferrer');
      } else {
        alert(`"${guide.title}" 가이드가 곧 준비됩니다!\n\n현재 페이지별 HTML로 변환 중입니다.`);
      }
    }

    // CTA tracking function
    function trackCTA(ctaType, campaign) {
      // GA4 tracking
      if (typeof gtag === 'function') {
        gtag('event', 'cta_click', {
          cta_type: ctaType,
          campaign: campaign,
          engagement_time_msec: 1000
        });
      }

      // Custom tracking (existing endpoint)
      const payload = {
        cid: getCidForTracking(),
        page: location.href,
        title: document.title,
        event_name: 'cta_click',
        params: {
          cta_type: ctaType,
          campaign: campaign
        }
      };
      sendTrackingData(payload);

      // Enhanced tracking: CTA clicked with scoring
      let score = 0;
      if (ctaType === 'primary') {
        score = 15; // Modal open, guide interest
      } else if (ctaType === 'secondary') {
        score = 100; // Arki Finance visit - highest value action
      } else if (ctaType === 'tertiary') {
        score = 30; // LinkedIn follow - social engagement
      }
      
      trackUserScore(`cta_click_${ctaType}`, score, {
        cta_type: ctaType,
        campaign: campaign,
        guide_context: currentGuide
      });

      // Handle actual link navigation for secondary CTAs
      if (ctaType === 'secondary' && GUIDES[currentGuide]) {
        const guide = GUIDES[currentGuide];
        if (campaign.startsWith('arki_')) {
          setTimeout(() => {
            window.open(guide.arki_link, '_blank', 'noopener,noreferrer');
          }, 100);
        }
      }
    }

    // Ebook download tracking
    function trackEbookDownload(slug, filename) {
      // GA4 tracking
      if (typeof gtag === 'function') {
        gtag('event', 'ebook_download', {
          guide_slug: slug,
          file_name: filename,
          engagement_time_msec: 1000
        });
      }

      // Custom tracking
      const payload = {
        cid: getCidForTracking(),
        page: location.href,
        title: document.title,
        event_name: 'ebook_download',
        params: {
          guide_slug: slug,
          file_name: filename
        }
      };
      sendTrackingData(payload);
    }

    // Guide tab click tracking
    function trackGuideClick(guideId) {
      const guide = GUIDES[guideId];
      
      // GA4 tracking
      if (typeof gtag === 'function') {
        gtag('event', 'guide_tab_click', {
          guide_slug: guide.slug,
          guide_title: guide.title,
          engagement_time_msec: 1000
        });
      }

      // Enhanced user journey tracking
      trackUserScore('guide_tab_click', 15, {
        guide_slug: guide.slug,
        guide_title: guide.title,
        click_source: 'modal_tab'
      });

      // Custom tracking
      const payload = {
        cid: getCidForTracking(),
        page: location.href,
        title: document.title,
        event_name: 'guide_tab_click',
        params: {
          guide_slug: guide.slug,
          guide_title: guide.title,
          click_source: 'modal_tab'
        }
      };
      sendTrackingData(payload);
    }

    // Form submit tracking (for future use)
    function trackFormSubmit(formType, formData) {
      // GA4 tracking
      if (typeof gtag === 'function') {
        gtag('event', 'form_submit', {
          form_type: formType,
          engagement_time_msec: 1000
        });
      }

      // Custom tracking
      const payload = {
        cid: getCidForTracking(),
        page: location.href,
        title: document.title,
        event_name: 'form_submit',
        params: {
          form_type: formType,
          ...formData
        }
      };
      sendTrackingData(payload);
    }

    // Helper functions for tracking
    function getCidForTracking() {
      try {
        let cid = localStorage.getItem('ft_client_id');
        if (!cid) {
          cid = 'cid.' + Math.random().toString(36).slice(2) + '.' + Date.now();
          localStorage.setItem('ft_client_id', cid);
        }
        return cid;
      } catch (_) {
        return 'cid.' + Math.random().toString(36).slice(2) + '.' + Date.now();
      }
    }

    function sendTrackingData(data) {
      const endpoint = '/api/track';
      const blob = new Blob([JSON.stringify(data)], { type: 'application/json' });
      if (navigator.sendBeacon && navigator.sendBeacon(endpoint, blob)) return;
      try {
        fetch(endpoint, { 
          method: 'POST', 
          headers: { 'Content-Type': 'application/json' }, 
          body: JSON.stringify(data), 
          keepalive: true 
        });
      } catch (_) {}
    }

    // ===== ENHANCED USER JOURNEY TRACKING =====
    
    // User engagement scoring system
    function trackUserScore(action, score, additionalData = {}) {
      try {
        let userScore = parseInt(localStorage.getItem('user_engagement_score') || '0');
        let sessionScore = parseInt(sessionStorage.getItem('session_engagement_score') || '0');
        
        userScore += score;
        sessionScore += score;
        
        localStorage.setItem('user_engagement_score', userScore.toString());
        sessionStorage.setItem('session_engagement_score', sessionScore.toString());
        
        const userSegment = getUserSegment(userScore);
        const sessionSegment = getSessionSegment(sessionScore);
        
        // Track to GA4
        if (typeof gtag === 'function') {
          gtag('event', 'user_engagement_score', {
            action: action,
            score: score,
            total_score: userScore,
            session_score: sessionScore,
            user_segment: userSegment,
            session_segment: sessionSegment,
            engagement_time_msec: 1000,
            ...additionalData
          });
        }
        
        // Custom tracking
        const payload = {
          cid: getCidForTracking(),
          page: location.href,
          title: document.title,
          event_name: 'user_engagement_score',
          params: {
            action: action,
            score: score,
            total_score: userScore,
            session_score: sessionScore,
            user_segment: userSegment,
            session_segment: sessionSegment,
            ...additionalData
          }
        };
        sendTrackingData(payload);
        
        // Check for segment upgrade
        checkSegmentUpgrade(userSegment, sessionSegment);
        
        return { userSegment, sessionSegment, userScore, sessionScore };
      } catch (error) {
        console.error('Error tracking user score:', error);
        return null;
      }
    }
    
    // User segmentation based on total engagement score
    function getUserSegment(score) {
      if (score >= 200) return 'hot_lead';      // Guide completion + Arki visit + multiple actions
      if (score >= 100) return 'warm_lead';     // Guide completion or Arki visit
      if (score >= 50) return 'interested';     // Guide download + some interaction
      if (score >= 20) return 'engaged';        // Modal opened + some interaction
      return 'visitor';                         // Basic interaction only
    }
    
    // Session segmentation based on current session score
    function getSessionSegment(score) {
      if (score >= 150) return 'hot_session';   // High engagement in current session
      if (score >= 75) return 'warm_session';   // Moderate engagement
      if (score >= 25) return 'active_session'; // Some engagement
      return 'passive_session';                 // Low engagement
    }
    
    // Check for segment upgrades and trigger events
    function checkSegmentUpgrade(currentSegment, sessionSegment) {
      const lastSegment = localStorage.getItem('last_user_segment');
      
      if (lastSegment !== currentSegment) {
        localStorage.setItem('last_user_segment', currentSegment);
        
        // Track segment upgrade
        if (typeof gtag === 'function') {
          gtag('event', 'user_segment_upgrade', {
            previous_segment: lastSegment || 'new_user',
            new_segment: currentSegment,
            session_segment: sessionSegment
          });
        }
        
        // Trigger personalized actions based on segment
        triggerSegmentActions(currentSegment, sessionSegment);
      }
    }
    
    // Trigger actions based on user segment
    function triggerSegmentActions(userSegment, sessionSegment) {
      // Hot lead actions
      if (userSegment === 'hot_lead' && sessionSegment === 'hot_session') {
        // Could trigger a special offer popup, priority support, etc.
        console.log('🔥 Hot Lead detected! Consider priority engagement.');
      }
      
      // Warm lead actions  
      else if (userSegment === 'warm_lead') {
        // Could show additional guides, newsletter signup, etc.
        console.log('🔥 Warm Lead detected! Consider additional content offers.');
      }
    }
    
    // Enhanced page view tracking with context
    function trackEnhancedPageView(pageContext = {}) {
      const visitCount = parseInt(localStorage.getItem('visit_count') || '0') + 1;
      const sessionPageViews = parseInt(sessionStorage.getItem('session_page_views') || '0') + 1;
      
      localStorage.setItem('visit_count', visitCount.toString());
      sessionStorage.setItem('session_page_views', sessionPageViews.toString());
      
      trackUserScore('page_view', 5, {
        visit_count: visitCount,
        session_page_views: sessionPageViews,
        is_returning_user: visitCount > 1,
        ...pageContext
      });
    }
    
    // Initialize enhanced tracking when page loads
    function initializeEnhancedTracking() {
      // Track enhanced page view
      trackEnhancedPageView({
        page_type: 'landing',
        referrer_domain: document.referrer ? new URL(document.referrer).hostname : 'direct'
      });
      
      // Track time on page
      let timeOnPage = 0;
      const timeTrackingInterval = setInterval(() => {
        timeOnPage += 10;
        
        // Track milestone engagements
        if (timeOnPage === 30) { // 30 seconds
          trackUserScore('time_engagement_30s', 10, { time_on_page: 30 });
        } else if (timeOnPage === 60) { // 1 minute
          trackUserScore('time_engagement_1min', 15, { time_on_page: 60 });
        } else if (timeOnPage === 120) { // 2 minutes
          trackUserScore('time_engagement_2min', 20, { time_on_page: 120 });
        }
      }, 10000); // Check every 10 seconds
      
      // Clear interval on page unload
      window.addEventListener('beforeunload', () => {
        clearInterval(timeTrackingInterval);
        
        // Track session end
        if (typeof gtag === 'function') {
          gtag('event', 'session_end', {
            time_on_page: timeOnPage,
            final_score: sessionStorage.getItem('session_engagement_score') || '0',
            final_segment: getUserSegment(parseInt(localStorage.getItem('user_engagement_score') || '0'))
          });
        }
      });
    }

    // Close modal on outside click
    document.getElementById('guideModal').addEventListener('click', function(e) {
      if (e.target === this) {
        closeGuideModal();
      }
    });

    // Close modal on Escape key
    document.addEventListener('keydown', function(e) {
      if (e.key === 'Escape') {
        closeGuideModal();
      }
    });

    // Initialize default guide content
    document.addEventListener('DOMContentLoaded', function() {
      showGuide('stock-guide');
      
      // Initialize enhanced tracking system
      if (typeof initializeEnhancedTracking === 'function') {
        initializeEnhancedTracking();
      }
    });
    
    // Listen for guide completion messages from child windows
    window.addEventListener('message', function(event) {
      if (event.data && event.data.type === 'guide_completion') {
        const { guideId, score, totalScore } = event.data;
        
        // Update local tracking with completion data
        trackUserScore('guide_completion_return', score, {
          guide_id: guideId,
          completed_in_new_window: true,
          total_score_after_completion: totalScore
        });
        
        console.log(`🎉 Guide ${guideId} completed! New total score: ${totalScore}`);
      }
    });
    
    // Seminar survey function - opens Microsoft Forms
    function openSeminarSurvey() {
      const formsUrl = 'https://forms.office.com/r/ysKrqYZdJ5';
      
      // Track survey interest before opening
      trackUserScore('seminar_survey_interest', 20, {
        survey_type: 'seminar_topic_suggestion',
        user_action: 'survey_opened',
        forms_url: formsUrl
      });
      
      // Open Microsoft Forms in new tab
      window.open(formsUrl, '_blank', 'noopener,noreferrer');
    }
  </script>
</body>
</html>